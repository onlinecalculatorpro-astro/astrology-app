<script>
    function showTab(tabId) {
        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // Show selected tab
        document.getElementById(tabId).classList.add('active');
        event.target.classList.add('active');
    }
    
    function getPredictions() {
        const button = event.target;
        const originalText = button.textContent;
        
        // Show loading state
        button.textContent = 'Generating Predictions...';
        button.disabled = true;
        
        // Prepare birth chart data from the current page
        const birthChart = {
            birth_chart: {
                planets: {
                    sun: { longitude: parseFloat('{{ chart.planets.sun.longitude if chart.planets and chart.planets.sun else "0" }}') },
                    moon: { longitude: parseFloat('{{ chart.planets.moon.longitude if chart.planets and chart.planets.moon else "0" }}') }
                },
                sun_sign: '{{ chart.sun_sign or "" }}',
                moon_sign: '{{ chart.moon_sign or "" }}'
            },
            prediction_date: new Date().toISOString().split('T')[0]
        };
        
        // Make AJAX request to predictions endpoint
        fetch('/predictions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(birthChart)
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                displayPredictions(data.predictions, data.prediction_date);
            } else {
                showPredictionError(data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showPredictionError('Unable to generate predictions. Please try again.');
        })
        .finally(() => {
            // Restore button state
            button.textContent = originalText;
            button.disabled = false;
        });
    }
    
    function displayPredictions(predictions, predictionDate) {
        const predictionsSection = document.querySelector('.predictions-section');
        
        // Create predictions display
        let predictionsHTML = `
            <div class="section-title">Current Predictions (${predictionDate})</div>
            <div class="predictions-list">
        `;
        
        predictions.forEach(prediction => {
            const strengthClass = prediction.strength === 'strong' ? 'strong-prediction' : 'moderate-prediction';
            predictionsHTML += `
                <div class="prediction-item ${strengthClass}">
                    <div class="prediction-description"><strong>${prediction.description}</strong></div>
                    <div class="prediction-interpretation">${prediction.interpretation}</div>
                    <div class="prediction-meta">Type: ${prediction.type} | Strength: ${prediction.strength}</div>
                </div>
            `;
        });
        
        predictionsHTML += '</div>';
        
        // Replace the predictions section content
        predictionsSection.innerHTML = predictionsHTML;
        
        // Add styles for predictions if not already present
        if (!document.getElementById('predictions-styles')) {
            const style = document.createElement('style');
            style.id = 'predictions-styles';
            style.textContent = `
                .predictions-list { margin-top: 15px; }
                .prediction-item { 
                    background: white; 
                    padding: 15px; 
                    margin-bottom: 10px; 
                    border-radius: 8px; 
                    border-left: 4px solid #ffa500; 
                }
                .strong-prediction { border-left-color: #ff6b35; }
                .moderate-prediction { border-left-color: #4ecdc4; }
                .prediction-description { font-weight: bold; color: #333; margin-bottom: 8px; }
                .prediction-interpretation { color: #666; margin-bottom: 5px; }
                .prediction-meta { font-size: 0.8rem; color: #999; }
            `;
            document.head.appendChild(style);
        }
    }
    
    function showPredictionError(errorMessage) {
        const predictionsSection = document.querySelector('.predictions-section');
        predictionsSection.innerHTML = `
            <div class="section-title">Predictions Error</div>
            <div class="prediction-item" style="border-left-color: #dc3545;">
                <div class="prediction-description">Unable to Generate Predictions</div>
                <div class="prediction-interpretation">${errorMessage}</div>
            </div>
        `;
    }
</script>
